#!/usr/bin/env bash

set -e
set -o pipefail

url="https://releases.hashicorp.com/terraform/"

failed() {
    echo "$@" >&2 && exit 1
}

version_sort() {
    if hash gsort 2>/dev/null
    then
        gsort -V
    else
        sort -V
    fi || failed "Your sort command doesn't support version sorting. If you are using macOS istall it using 'brew install coreutils'"
}

curl -s "$url" \
    | grep -oE '/terraform/[[:digit:]]\.[[:digit:]]+\.[[:digit:]]+[^/]*' \
    | sed 's,/terraform/,,' \
    | version_sort \
    || failed "Could not fetch list of Terraform versions"
